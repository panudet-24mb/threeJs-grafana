<!DOCTYPE html>
<html lang="en">
	<head>
		<title>thxd 3MF</title>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
		/>
		<link type="text/css" rel="stylesheet" href="main.css" />
		<style>
			body {
				background-color: #333;
			}
		</style>
	</head>
	<body>
		<div id="info">
			{{info}}
		</div>

		<script src="js/libs/jszip.min.js"></script>
		<script src="/node_modules/axios/dist/axios.min.js"></script>

		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

		<script
			type="à¹ˆtext/javascript"
			src="../node_modules/influx-api/lib/index.js.map"
		></script>

		<script type="module">
			import * as THREE from "../build/three.module.js";

			import { OrbitControls } from "./jsm/controls/OrbitControls.js";
			import { ThreeMFLoader } from "./jsm/loaders/3MFLoader.js";

			var camera, scene, renderer;
			var mesh, spriteLabel;
			var material, stats;

			init();

			function init() {
				renderer = new THREE.WebGLRenderer({ antialias: true });
				renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setSize(window.innerWidth, window.innerHeight);
				document.body.appendChild(renderer.domElement);

				scene = new THREE.Scene();
				scene.background = new THREE.Color(0x333333);

				scene.add(new THREE.AmbientLight(0xffffff, 0.2));

				camera = new THREE.PerspectiveCamera(
					60,
					window.innerWidth / window.innerHeight,
					1,
					500
				);

				// Z is up for objects intended to be 3D printed.

				camera.up.set(0, 0, 0);
				camera.position.set(-60, 100, 300);
				scene.add(camera);

				var controls = new OrbitControls(camera, renderer.domElement);
				controls.addEventListener("change", render);
				controls.minDistance = 50;
				controls.maxDistance = 300;
				controls.enablePan = true;
				controls.target.set(0, 0, 0);
				controls.update();

				var pointLight = new THREE.PointLight(0xffffff, 0.8);
				camera.add(pointLight);
				var loader = new ThreeMFLoader();
				loader.load("./models/3mf/Assem1.3mf", function(object) {
					scene.add(object);
					render();
				});

				window.addEventListener("resize", onWindowResize, false);
			}

			var spritey = makeTextSprite( {info} , {
				fontsize: 70,
				textColor: { r: 255, g: 255, b: 255, a: 1.0 }
			});
			spritey.position.set(5, 40, 40);
			scene.add(spritey);

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize(window.innerWidth, window.innerHeight);

				render();
			}

			// // load the GIF texture
			// var textureLoader = new THREE.TextureLoader().load(
			// 	"/examples/models/3mf/dance.gif"
			// );
			// // Create material
			// material = new THREE.MeshBasicMaterial({
			// 	map: textureLoader
			// });
			// var geometry = new THREE.BoxGeometry(100, 100, 100);
			// mesh = new THREE.Mesh(geometry, material);
			// scene.add(mesh);

			function makeTextSprite(message, parameters) {
				if (parameters === undefined) parameters = {};
				var fontface = parameters.hasOwnProperty("fontface")
					? parameters["fontface"]
					: "Courier New";
				var fontsize = parameters.hasOwnProperty("fontsize")
					? parameters["fontsize"]
					: 18;
				var borderThickness = parameters.hasOwnProperty("borderThickness")
					? parameters["borderThickness"]
					: 4;
				var borderColor = parameters.hasOwnProperty("borderColor")
					? parameters["borderColor"]
					: { r: 0, g: 0, b: 0, a: 1.0 };
				var backgroundColor = parameters.hasOwnProperty("backgroundColor")
					? parameters["backgroundColor"]
					: { r: 0, g: 0, b: 255, a: 1.0 };
				var textColor = parameters.hasOwnProperty("textColor")
					? parameters["textColor"]
					: { r: 0, g: 0, b: 0, a: 1.0 };

				var canvas = document.createElement("canvas");
				var context = canvas.getContext("2d");
				context.font = "Bold " + fontsize + "px " + fontface;
				var metrics = context.measureText(message);
				var textWidth = metrics.width;

				context.fillStyle =
					"rgba(" +
					backgroundColor.r +
					"," +
					backgroundColor.g +
					"," +
					backgroundColor.b +
					"," +
					backgroundColor.a +
					")";
				context.strokeStyle =
					"rgba(" +
					borderColor.r +
					"," +
					borderColor.g +
					"," +
					borderColor.b +
					"," +
					borderColor.a +
					")";
				context.fillStyle =
					"rgba(" +
					textColor.r +
					", " +
					textColor.g +
					", " +
					textColor.b +
					", 1.0)";
				context.fillText(message, borderThickness, fontsize + borderThickness);

				var texture = new THREE.Texture(canvas);
				texture.needsUpdate = true;
				var spriteMaterial = new THREE.SpriteMaterial({
					map: texture,
					useScreenCoordinates: false
				});
				var sprite = new THREE.Sprite(spriteMaterial);
				sprite.scale.set(0.5 * fontsize, 0.25 * fontsize, 0.75 * fontsize);
				return sprite;
			}

			function render() {
				renderer.render(scene, camera);
			}

			// Dummy Url.
			const url =
				"http://10.222.43.12:8086/query?db=testtemp&q=select value from cpu_temp_load where host = 'jetson01'  order by time desc limit 2";
			const options = {
				headers: {
					"Content-Type": "application/x-www-form-urlencoded"
				}
			};

			// Axios Test.
			const axiosTest = axios.get;

			// Axios Test Data.
			axiosTest(url, options).then(function(axiosTestResult) {
				console.log({ data: axiosTestResult.data.results });

				const res_data = axiosTestResult.data;

				console.warn(res_data);
			});

			new Vue({
				el: "#info",
				data() {
					return {
						info: null
					};
				},
				mounted() {
					axios
						.get(
							"http://10.222.43.12:8086/query?db=testtemp&q=select value from cpu_temp_load where host = 'jetson01'  order by time desc limit 1"
						)
						.then(
							response =>
								(this.info = response.data.results[0].series[0].values[0][1])
						
						
						);

						this.state = info;
						console.log(info);

				
				}
			});
		</script>
	</body>
</html>
